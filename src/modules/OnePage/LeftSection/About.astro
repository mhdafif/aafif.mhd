---
import Modal from "@/components/Modal.astro";
import Tooltip from "@/components/Tooltip.astro";
import Education from "@/modules/About/Education.astro";
import Introduction from "@/modules/About/Introduction.astro";
import Testimony from "@/modules/About/Testimony.astro";
import { Icon } from "astro-icon/components";
const items = ["About", "Education", "Feedback"];
---

<div
  class="about-container card-blacki p-4 rounded-lg border border-solid border-off-white/10 relative"
>
  <div
    class="shortcut-key absolute right-0 top-0 text-blacki rounded-tr-sm rounded-bl-sm w-7 aspect-square outline-4 outline-solid outline-charcoal flex justify-center items-center group z-[1]"
  >
    <div
      class="bg-star w-full h-full text-center font-semibold text-lg rounded-tr-sm rounded-bl-sm group-hover:opacity-70 transition-all duration-500 ease-out relative cursor-default"
    >
      1
    </div>
    <Tooltip content="Shortcut : 1" />
  </div>

  <div class="about-items flex flex-col gap-8 relative">
    {
      items.map((item) => (
        <div class="about-item relative">
          <span class=" font-semibold text-lg relative hover:text-star transition-all duration-300 ease-out cursor-default bg-blacki">
            {item}
          </span>
          <div class="line" />
        </div>
      ))
    }
    <button
      id="more-about"
      class="shortcut absolute right-0 bottom-[-1.5px] cursor-pointer group flex justify-center outline-none"
    >
      <Icon
        name="ic:baseline-open-in-new"
        class="relative w-8 h-8 text-star group-hover:animate-pulse transition-all duration-100 ease-out"
      />
      <!-- <Tooltip content="Click to see more" /> -->
    </button>
  </div>
</div>

<!-- Modal About -->
<Modal title="About" modalId="modal-about">
  <Introduction />
  <Education />
  <Testimony />
</Modal>

<!-- <div id="modal-about" class="modal">
  <div class="modal-container scroll-smooth">
    <div class="laptop:space-y-5">
      <div class="modal-title">
        <Title text="About" />
        <Icon
          id="close-btn"
          name="ic:round-close"
          class="absolute w-8 h-8 text-charcoal hover:text-star/80 transition-all duration-500 ease-out cursor-pointer top-6 right-0"
        />
      </div>
      <div class="modal-content space-y-5 mb-5">
        <Introduction />
        <Education />
        <Testimony />
      </div>
    </div>
  </div>
</div> -->
<!-- <div class="relative">
  <div
    class="card-blacki tes-clip w-[312px] h-[160px] border border-solid border-off-white/10"
  >
  </div>
  <div class="absolute top-4 w-1/2 h-[32px] p-1 pl-0">
    <div class="w-full rounded-sm text-lg">About</div>
  </div>
</div> -->

<script>
  const modalAbout = document.getElementById("modal-about");
  const moreAbout = document.getElementById("more-about");
  const closeBtn = document.getElementById("modal-about-close");
  const modalContainer = modalAbout.querySelector(".modal-container");

  function handleOpenModal(isOpen: boolean) {
    // const anyModalOpen = document.querySelector(".modal-open");
    // if (isOpen) {
    //   if (!anyModalOpen) {
    //     modalAbout.classList.add("modal-open");
    //   }
    // } else {
    //   modalContainer.scrollTo({ top: 0, behavior: "smooth" });
    //   modalAbout.classList.remove("modal-open");
    // }
    // document.body.style.overflow = isOpen ? "hidden" : "";
    const anyModalOpen = document.querySelector(".modal.modal-open");

    // Prevent opening if another modal is already open
    if (isOpen && anyModalOpen && anyModalOpen !== modalAbout) {
      // console.warn("Another modal is already open.");
      return;
    }

    if (isOpen) {
      modalAbout.classList.add("modal-open");
      document.body.style.overflow = "hidden";
    } else {
      modalContainer.scrollTo({ top: 0, behavior: "smooth" });
      modalAbout.classList.remove("modal-open");

      // Check if there are no more modals open, then reset scroll
      if (!document.querySelector(".modal.modal-open")) {
        document.body.style.overflow = "";
      }
    }
  }

  addEventListener("keydown", (event) => {
    if (event.key === "1") {
      handleOpenModal(true);
    }
    if (event.key === "Escape") {
      handleOpenModal(false);
    }
  });
  moreAbout.addEventListener("click", () => {
    handleOpenModal(true);
  });
  closeBtn.addEventListener("click", () => {
    handleOpenModal(false);
  });
  modalAbout.addEventListener("click", (event: any) => {
    if (modalAbout.classList.contains("modal-open")) {
      if (!modalContainer.contains(event.target)) {
        handleOpenModal(false);
      }
    }
  });
</script>
<style is:global lang="scss">
  .about-container {
    .about-item {
      &:nth-child(odd) {
        span {
          border-right: 4px solid rgba(250, 249, 246, 0.1);
          padding-right: 0.5rem;
          // &:hover {
          //   border-color: var(--color-star);
          // }
        }
      }
      &:nth-child(even) {
        text-align: end;
        span {
          border-left: 4px solid rgba(250, 249, 246, 0.1);
          padding-left: 0.5rem;
          // &:hover {
          //   border-color: var(--color-star);
          // }
        }
      }
      .line {
        &::after {
          content: "";
          top: 11.5px;
          height: calc(100% + 1rem);
          position: absolute;
          border-width: 4px;
          border-style: dashed;
          border-color: rgba(250, 249, 246, 0.1);
          transition: all 0.3s ease-out;
        }
        // &:hover {
        //   &::after {
        //     border-color: var(--color-star);
        //   }
        // }
      }
      &:nth-child(1) {
        .line {
          &::after {
            left: 64px;
            border-left: 0;
            border-bottom: 0;
            border-top-right-radius: 4px;
            width: calc(100% - 64px - 40px);
          }
        }
      }
      &:nth-child(2) {
        .line {
          &::after {
            right: 97px;
            border-right: 0;
            border-bottom: 0;
            border-top-left-radius: 4px;
            width: calc(100% - 97px - 36px);
          }
        }
      }
      &:nth-child(3) {
        .line {
          &::after {
            left: 84px;
            border-right: 0;
            border-bottom: 0;
            border-left: 0;
            width: calc(100% - 84px - 36px);
          }
        }
        // &:hover ~ button {
        //   > svg {
        //     color: var(--color-star);
        //   }
        // }
      }
      &:hover {
        span {
          border-color: var(--color-star);
        }
        > .line::after {
          border-color: rgba(250, 249, 246, 0.8);
        }
      }
    }
  }

  // .shortcut:hover {
  //   .tooltip {
  //     opacity: 1;
  //     pointer-events: initial;
  //     &.top {
  //       bottom: 1.75rem;
  //     }

  //     &.bottom {
  //       top: 1.75rem;
  //     }
  //   }
  // }
  .tes-clip {
    clip-path: path(
      " M 8,0 L 304,0 A 8,8 0,0,1 312,8 L 312,60 A 4,4 0,0,1 308,64 L 160,64 A 4,4 0,0,0 156,68 L 156,92 A 4,4 0,0,0 160,96 L 308,96 A 4,4 0,0,1 312,100 L 312,152 A 8,8 0,0,1 304,160 L 8,160 A 8,8 0,0,1 0,152 L 0,148 A 4,4 0,0,1 4,144 L 152,144 A 4,4 0,0,0 156,140 L 156,116 A 4,4 0,0,0 152,112 L 4,112 A 4,4 0,0,1 0,108 L 0,52 A 4,4 0,0,1 4,48 L 152,48 A 4,4 0,0,0 156,44 L 156,20 A 4,4 0,0,0 152,16 L 4,16 A 4,4 0,0,1 0,12 L 0,8 A 8,8 0,0,1 8,0 Z"
    );
  }

  // .modal {
  //   z-index: -5;
  //   pointer-events: none;
  //   width: 100vw;
  //   height: 100vh;
  //   position: fixed;
  //   top: 0;
  //   left: 0;
  //   transition: 0.3s all ease-out;
  //   opacity: 0;
  //   display: flex;
  //   justify-content: center;

  //   &::after {
  //     content: "";
  //     background-color: var(--color-blacki);
  //     opacity: 0.7;
  //     width: 100%;
  //     height: 100%;
  //   }

  //   .modal-container {
  //     position: absolute;
  //     z-index: 1;
  //     background-color: var(--color-blacki);
  //     border-top-left-radius: 8px;
  //     border-top-right-radius: 8px;
  //     width: 100%;
  //     max-width: 72rem;
  //     height: 80vh;
  //     border: 1px solid rgba(250, 249, 246, 0.2);
  //     border-bottom: 0;
  //     top: 105%;
  //     transition: 0.3s all ease-out;
  //     padding: 0 2rem;
  //     overflow: auto;

  //     .modal-title {
  //       position: sticky;
  //       top: 0;
  //       background: var(--color-blacki);
  //       z-index: 1;
  //       padding-bottom: 3rem;
  //       padding-top: 1rem;
  //       margin-bottom: 0.5rem;
  //     }
  //   }
  // }
  // .modal-open {
  //   z-index: 99;
  //   opacity: 1;
  //   pointer-events: auto;

  //   .modal-container {
  //     top: 20%;
  //   }
  // }
</style>
