---
import Modal from "@/components/Modal.astro";
import Title from "@/components/Title.astro";
import Tooltip from "@/components/Tooltip.astro";
import { Icon } from "astro-icon/components";
import ExperienceModalContent from "./ModalContent/ExperienceModalContent.astro";

const experiences = [
  {
    company: "Ultravoucher",
    position: "Frontend Engineer",
    start: "Jan 2022",
    end: "May 2025",
    details: [
      "Lead and direct the frontend team to ensure consistent implementation of best practices",
      "Implement UI/UX designs from Figma into production-ready applications",
      "Build and maintain responsive applications optimized for desktop, webview, and webapp environments",
      "Ensure compatibility across all devices, including older mobile devices",
      "Refactor and revamp legacy applications using modern frontend technologies",
      "Design and develop complex UI/UX for internal dashboards",
      "Design and build a custom internal UI framework tailored for company-wide use",
      "Create a standardized boilerplate to streamline setup for new frontend projects",
      "Establish and implement frontend SOPs for the team",
      "Propose and implement new ideas to improve development workflow and scalability",
      "Conduct code cleaning and implement a ticket-based review system",
      "Enhance SEO and performance for various key products",
      "Collaborate with cross-functional teams to ensure high-quality, consistent frontend delivery",
    ],
  },
  {
    company: "Prospace",
    position: "Frontend Engineer",
    start: "Oct 2020",
    end: "Dec 2021",
    details: [
      "Maintain and develop B2B products tailored to client needs",
      "Implement UI features and enhancements based on client requirements",
      "Design and maintain unit testing strategy for application stability",
      "Ensure the smooth release and deployment of applications",
      "Collaborate with backend and QA teams to fix bugs and refine functionality",
      "Create an internal UI framework to standardize frontend development",
      "Contribute to performance optimization and UI consistency across products",
    ],
  },
  {
    company: "Xsis Mitra Utama",
    position: "Frontend Engineer",
    start: "Sep 2018",
    end: "Sep 2020",
    details: [
      "Revamped Employee Self Service application from Web Forms to microservice architecture using React and TypeScript",
      "Collaborated with backend teams to transition legacy systems into modern frontend architecture",
      // "Handled bug fixes and ongoing maintenance to ensure application stability",
      // "Maintained and improved UI/UX components for internal HR applications",
    ],
  },
];
---

<div
  class="card-blacki p-4 rounded-lg border border-solid border-off-white/10 relative"
>
  <div
    class="shortcut-key absolute right-0 top-0 text-blacki rounded-tr-sm rounded-bl-sm w-7 aspect-square outline-4 outline-solid outline-charcoal flex justify-center items-center group z-[1]"
  >
    <div
      class="bg-star w-full h-full text-center font-semibold text-lg rounded-tr-sm rounded-bl-sm group-hover:opacity-70 transition-all duration-500 ease-out relative cursor-default"
    >
      3
    </div>
    <Tooltip content="Shortcut : 3" />
  </div>

  <Title size="small" text="Experience" />

  <div class="mt-8 space-y-3">
    {
      experiences.map((item) => (
        <div class="exp-item bg-charcoal rounded-5 p-0.5 relative group">
          <div class="w-full h-full relative z-[1] rounded-5 bg-charcoal py-2 px-3">
            <h3 class="font-bold text-lg text-star">@ {item.company}</h3>
            <h4 class="text-off-white font-semibold">{item.position}</h4>
            <h6 class="text-off-white/50 font-medium">
              {item.start} - {item.end}
            </h6>
          </div>
        </div>
      ))
    }
    <div
      id="more-exp"
      class="w-full h-full bg-star rounded-5 flex items-center justify-center border border-solid border-charcoal hover:bg-star/80 transition-all duration-300 ease-out cursor-pointer hover:animate-pulse relative"
    >
      <Icon name="ic:baseline-open-in-new" class="text-5xl text-blacki" />
    </div>
  </div>
</div>

<!-- Modal Experience -->
<Modal title="Experiences" modalId="modal-exp">
  <div class="mt-6">
    <ExperienceModalContent />
  </div>
</Modal>

<script>
  const modalExp = document.getElementById("modal-exp");
  const moreExp = document.getElementById("more-exp");
  const closeBtn = document.getElementById("modal-exp-close");
  const modalContainer = modalExp.querySelector(".modal-container");

  function handleOpenModal(isOpen: boolean) {
    const anyModalOpen = document.querySelector(".modal.modal-open");

    if (isOpen && anyModalOpen && anyModalOpen !== modalExp) {
      return;
    }

    if (isOpen) {
      modalExp.classList.add("modal-open");
      document.body.style.overflow = "hidden";
    } else {
      modalContainer.scrollTo({ top: 0, behavior: "smooth" });
      modalExp.classList.remove("modal-open");
      if (!document.querySelector(".modal.modal-open")) {
        document.body.style.overflow = "";
      }
    }
  }

  addEventListener("keydown", (event) => {
    if (event.key === "3") {
      handleOpenModal(true);
    }
    if (event.key === "Escape") {
      handleOpenModal(false);
    }
  });
  moreExp.addEventListener("click", () => {
    handleOpenModal(true);
  });
  closeBtn.addEventListener("click", () => {
    handleOpenModal(false);
  });
  modalExp.addEventListener("click", (event: any) => {
    if (modalExp.classList.contains("modal-open")) {
      if (!modalContainer.contains(event.target)) {
        handleOpenModal(false);
      }
    }
  });
</script>

<style lang="scss">
  .exp-item::before {
    content: "";
    position: absolute;
    height: 10px;
    width: 10px;
    border-radius: 50%;
    top: 50%;
    transform: translateY(-50%);
    left: -4px;
    background: var(--color-charcoal);
    border: 1.5px solid rgba(250, 249, 246, 0.5);
    transition: all 0.3s ease-out;
    z-index: 2;
  }

  .exp-item:hover {
    &::before {
      border-color: var(--color-star);
      // background-color: var(--color-blacki);
    }
    &::after {
      background-color: var(--color-star);
    }
  }

  .exp-item::after {
    content: "";
    position: absolute;
    height: 50%;
    width: 50%;
    top: 50%;
    left: 0;
    background-color: rgba(250, 249, 246, 0.5);
    transition: all 0.3s ease-out;
    border-bottom-left-radius: 5px;
  }

  #modal-exp {
    .modal-container {
      // max-width: 45rem !important;
    }
  }
</style>
