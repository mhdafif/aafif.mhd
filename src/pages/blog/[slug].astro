---
import Layout from "@/components/Layout/Layout.astro";
import { Icon } from "astro-icon/components";
import blogsData from "@/data/blogs.json";

export async function getStaticPaths() {
  return blogsData.map((blog) => ({
    params: { slug: blog.slug },
    props: { blog },
  }));
}

const { blog } = Astro.props;

if (!blog) {
  return Astro.redirect("/404");
}

// Convert markdown-like content to HTML (basic implementation)
const formatContent = (content: string) => {
  return content
    .replace(
      /^# (.*$)/gm,
      '<h1 class="text-3xl font-bold text-off-white mb-6 mt-8">$1</h1>'
    )
    .replace(
      /^## (.*$)/gm,
      '<h2 class="text-2xl font-bold text-off-white mb-4 mt-6">$1</h2>'
    )
    .replace(
      /^### (.*$)/gm,
      '<h3 class="text-xl font-semibold text-off-white mb-3 mt-5">$1</h3>'
    )
    .replace(
      /\*\*(.*?)\*\*/g,
      '<strong class="font-semibold text-off-white">$1</strong>'
    )
    .replace(/\*(.*?)\*/g, '<em class="italic">$1</em>')
    .replace(
      /`(.*?)`/g,
      '<code class="bg-charcoal text-star px-1 py-0.5 rounded text-sm">$1</code>'
    )
    .replace(
      /```(\w+)?\n([\s\S]*?)```/g,
      '<pre class="bg-blacki border border-off-white/10 rounded-lg p-4 overflow-x-auto my-4"><code class="text-off-white/90 text-sm">$2</code></pre>'
    )
    .replace(/^\- (.*$)/gm, '<li class="text-off-white/80 mb-1">$1</li>')
    .replace(/^(\d+)\. (.*$)/gm, '<li class="text-off-white/80 mb-1">$2</li>')
    .replace(/\n\n/g, '</p><p class="text-off-white/80 mb-4">')
    .replace(
      /^(?!<[h|l|p|c])(.*$)/gm,
      '<p class="text-off-white/80 mb-4">$1</p>'
    );
};

const formattedContent = formatContent(blog.content);
---

<Layout>
  <main class="bg-blacki z-2 min-h-screen">
    <!-- Header -->
    <header class="bg-charcoal border-off-white/10 border-b">
      <div class="mx-auto max-w-4xl px-6 py-8">
        <nav class="mb-6">
          <a
            href="/"
            class="text-star hover:text-star/80 flex items-center gap-2 text-sm font-medium transition-colors"
          >
            <Icon name="ic:baseline-arrow-back" class="h-4 w-4" />
            Back to Home
          </a>
        </nav>

        <div class="mb-4">
          <div class="text-off-white/60 mb-4 flex items-center gap-2 text-sm">
            <time datetime={blog.publishedAt}>
              {
                new Date(blog.publishedAt).toLocaleDateString("en-US", {
                  year: "numeric",
                  month: "long",
                  day: "numeric",
                })
              }
            </time>
            <span>•</span>
            <span>{blog.readTime}</span>
            {
              blog.featured && (
                <>
                  <span>•</span>
                  <span class="bg-star/20 text-star rounded px-2 py-1 text-xs font-medium">
                    Featured
                  </span>
                </>
              )
            }
          </div>

          <h1 class="text-off-white mb-4 text-4xl leading-tight font-bold">
            {blog.title}
          </h1>

          <p class="text-off-white/70 mb-6 text-xl leading-relaxed">
            {blog.excerpt}
          </p>

          <div class="flex flex-wrap gap-2">
            {
              blog.tags.map((tag) => (
                <span class="bg-blacki text-off-white/70 hover:text-star rounded-full px-3 py-1 text-sm transition-colors">
                  {tag}
                </span>
              ))
            }
          </div>
        </div>
      </div>
    </header>

    <!-- Content -->
    <article class="mx-auto max-w-4xl px-6 py-12">
      <div class="prose prose-invert max-w-none">
        <div set:html={formattedContent} />
      </div>
    </article>

    <!-- Footer Navigation -->
    <footer class="bg-charcoal border-off-white/10 mt-16 border-t">
      <div class="mx-auto max-w-4xl px-6 py-8">
        <div class="flex items-center justify-between">
          <a
            href="/"
            class="text-star hover:text-star/80 flex items-center gap-2 font-medium transition-colors"
          >
            <Icon name="ic:baseline-arrow-back" class="h-4 w-4" />
            Back to Home
          </a>

          <div class="flex items-center gap-4">
            <span class="text-off-white/60 text-sm">Share this article:</span>
            <a
              href={`https://twitter.com/intent/tweet?text=${encodeURIComponent(blog.title)}&url=${encodeURIComponent(Astro.url.href)}`}
              target="_blank"
              rel="noopener noreferrer"
              class="text-off-white/60 hover:text-star transition-colors"
              aria-label="Share on Twitter"
            >
              <Icon name="ic:baseline-share" class="h-5 w-5" />
            </a>
          </div>
        </div>
      </div>
    </footer>
  </main>
</Layout>

<style>
  .prose {
    color: rgba(250, 249, 246, 0.8);
    line-height: 1.7;
  }

  .prose h1:first-child {
    margin-top: 0;
  }

  .prose p {
    margin-bottom: 1rem;
  }

  .prose ul,
  .prose ol {
    margin: 1rem 0;
    padding-left: 1.5rem;
  }

  .prose li {
    margin-bottom: 0.5rem;
  }

  .prose pre {
    background: var(--color-blacki);
    border: 1px solid rgba(250, 249, 246, 0.1);
    border-radius: 0.5rem;
    padding: 1rem;
    overflow-x: auto;
    margin: 1.5rem 0;
  }

  .prose code {
    background: var(--color-charcoal);
    color: var(--color-star);
    padding: 0.125rem 0.25rem;
    border-radius: 0.25rem;
    font-size: 0.875rem;
  }

  .prose pre code {
    background: transparent;
    color: rgba(250, 249, 246, 0.9);
    padding: 0;
  }

  .prose strong {
    color: var(--color-off-white);
    font-weight: 600;
  }

  .prose em {
    color: var(--color-off-white);
  }
</style>
