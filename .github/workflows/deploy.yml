name: üöÄ Deploy to Master

on:
  push:
    branches:
      - master # Runs only when pushing/merging to master branch

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: SSH into VPS and deploy
        run: |
          echo "${{ secrets.SSH_KEY }}" > key.pem
          chmod 600 key.pem

          ssh -o StrictHostKeyChecking=no \
              -i key.pem \
              ${{ secrets.SERVER_USER }}@${{ secrets.SERVER_HOST }} \
              cd /var/www/aafif.space
              git pull origin master
              pnpm install --frozen-lockfile
              pnpm build -- --sourcemap false
              sudo systemctl reload caddy || echo "‚ö†Ô∏è Skipped Caddy reload (no sudo permission)"

      - name: Clean up
        run: rm -f key.pem
